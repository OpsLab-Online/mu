<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>MU</title>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png">

    <link rel="stylesheet" href="asserts/bulma.min.css">
    <link rel="stylesheet" href="asserts/nprogress.css">
    <script src="asserts/vue.js"></script>
    <script type="text/javascript" src="asserts/axios.min.js"></script>
    <script type="text/javascript" src="asserts/nprogress.js"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }
        .section {
            padding-top: 1rem;
        }
        .logo {
            text-align: center;
            font-size: 1.2rem;
            font-family: Monaco;
        }
        .logo img {
            width: 36px;
            height: 36px;
        }
        .container {
            max-width: 960px;
        }
        .hot-list {
            flex-basis: unset;
            width: 100%;
        }
        .tab-tag {
            padding-top: 0px;
            padding-bottom: 0px;
            cursor: pointer;
        }
        .hot {
            width: 100%;
            height: 2.5rem;
            line-height: 2.5rem;
        }
        .hot a {
            display: block;
            max-width: 98%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .hot-ts {
            color: #939393;
            font-size: 0.8rem;
        }
        .copyright {
            font-size: 0.85rem;
        }
    </style>
</head>
<body>
<section class="section">
    <div class="container" id="app">
        <div class="logo"><img src="logo.png" alt=""></div>
        <div class="columns">
            <div class="column">
                <div class="tabs">
                    <ul>
                        <li v-for="(tab, idx) in tabs" :class="{ 'is-active' : idx == selected.tab }" @click="switchTab(idx)"><a>{{ tab.name }}</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="columns">
            <div class="column tab-tag tags">
                <span @click="switchTag(idx)" :class="[ 'tag', { 'is-primary' : idx == selected.tag } ]" v-for="(tag, idx) in tabs[selected.tab]['tags']">{{ tag.name }}</span>
            </div>
        </div>
        <p class="hot-ts" v-if="t != '' ">更新时间: {{ t }}</p>
        <div class="columns">
            <div class="column hot-list">
                <div class="hot" v-for="(hot, idx) in list">
                    <a :href="hot.origin_url" :title="hot.title" target="_blank">{{ hot.title }}</a>
                </div>
            </div>
        </div>
        <div class="columns">
            <div class="column">
                <p class="copyright has-text-centered">
                    <a href="https://github.com/aaronzjc">@aaronzjc</a>开发, 源码<a href="https://github.com/aaronzjc/crawler">在此</a>，欢迎Star.
                </p>
            </div>
        </div>
    </div>
</section>

<script type="text/javascript">
    const API = {
        config: "https://mu.memosa.cn/config",
        list: "https://mu.memosa.cn/aj"
    };
    var vn = new Vue({
        el: "#app",
        created: function () {
            this.fetchConfig(this.fetchList);
        },
        data: {
            tabs: [
                {
                    "name": "",
                    "key": undefined,
                    "tags": [
                        {
                            "name": "",
                            "key": undefined
                        }
                    ]
                }
            ],
            selected: {
                tab: 0,
                tag: 0
            },
            list: [],
            t: ""
        },
        methods: {
            fetchConfig: function (callback) {
                axios.get(API.config).then(function (resp) {
                    this.tabs = resp.data;
                    if (typeof callback == "function") {
                        callback();
                    }
                }.bind(this)).catch(function (err) {

                })
            },
            fetchList: function () {
                NProgress.start();
                var key = this.tabs[this.selected.tab]["key"];
                var hkey = this.tabs[this.selected.tab]["tags"][this.selected.tag]["key"];
                if (hkey === undefined || key === undefined) {
                    return false;
                }
                axios.get(API.list, {
                    params: {
                        key: this.tabs[this.selected.tab]["key"],
                        hkey: this.tabs[this.selected.tab]["tags"][this.selected.tag]["key"]
                    }
                }).then(function (resp) {
                    var list = resp.data.list;
                    this.list = list;
                    this.t = resp.data.t;
                    NProgress.done();
                }.bind(this)).catch(function (err) {

                })
            },
            switchTab: function (idx) {
                this.selected.tab = idx;
                this.selected.tag = 0;
                this.fetchList()
            },
            switchTag: function (idx) {
                this.selected.tag = idx;
                this.fetchList()
            }
        }
    })
</script>
</body>
</html>